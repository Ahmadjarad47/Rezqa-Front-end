<div class="container mx-auto px-4 py-6 min-h-screen bg-white dark:bg-gray-800">
    <!-- Header with Theme Toggle -->
    <div class="mb-6 flex justify-between items-start dark">
        <div class="dark">
            <h1 class="text-3xl font-bold header-gradient mb-2 dark">إعلاناتي</h1>
            <p class="text-gray-600 dark:text-gray-400 dark">إدارة إعلاناتك ومتابعة أدائها</p>
        </div>

        <!-- Theme Toggle -->
        <div class="flex items-center gap-4 dark">


            <!-- Refresh Button -->
            <button (click)="refreshAds()" [disabled]="isRefreshing"
                class="btn-secondary px-3 py-2 rounded-lg focus-visible:focus dark" title="تحديث الإعلانات">
                <svg class="w-5 h-5 refresh-icon" [class.spinning]="isRefreshing" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                    </path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Error Alert -->
    <div *ngIf="error"
        class="mb-6 border text-[#0061fe] px-4 py-3 rounded-lg backdrop-blur-sm" style="background-color:#0061fe; border-color:#0061fe; color:white;">
        <div class="flex">
            <svg class="w-5 h-5 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                    clip-rule="evenodd"></path>
            </svg>
            <span>{{ error }}</span>
        </div>
    </div>

    <!-- Success Alert -->
    <div *ngIf="successMessage"
        class="mb-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded-lg backdrop-blur-sm">
        <div class="flex">
            <svg class="w-5 h-5 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"></path>
            </svg>
            <span>{{ successMessage }}</span>
        </div>
    </div>

    <!-- Controls Section -->
    <div class="control-card rounded-lg p-6 mb-6  bg-white dark:bg-gray-800">
        <!-- Search and Filters Row -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 ">
            <!-- Search -->
            <div class="md:col-span-2">
                <label for="search" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">البحث في
                    الإعلانات</label>
                <div class="relative">
                    <input type="text" id="search" [(ngModel)]="searchTerm" (input)="onSearch()"
                        placeholder="البحث بالعنوان، الوصف، الفئة، أو الموقع..."
                        class="advanced-input w-full pl-10 pr-4 py-2 rounded-lg">
                    <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>

            <!-- Status Filter -->
            <div>
                <label for="status"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">الحالة</label>
                <select id="status" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()"
                    class="advanced-input w-full px-3 py-2 rounded-lg">
                    <option value="all">جميع الحالات</option>
                    <option value="active">نشط</option>
                    <option value="inactive">غير نشط</option>
                </select>
            </div>

            <!-- Sort -->
            <div>
                <label for="sort" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ترتيب
                    حسب</label>
                <select id="sort" [(ngModel)]="sortBy" (change)="applyFilters()"
                    class="advanced-input w-full px-3 py-2 rounded-lg">
                    <option value="createdAt">تاريخ الإنشاء</option>
                    <option value="title">العنوان</option>
                    <option value="price">السعر</option>
                    <option value="category">الفئة</option>
                </select>
            </div>
        </div>

        <!-- Advanced Controls Row -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div class="flex items-center gap-4">
                <!-- Sort Order Toggle -->
                <button (click)="onSort(sortBy)"
                    class="btn-secondary px-3 py-2 text-sm font-medium rounded-lg focus-visible:focus">
                    <svg *ngIf="sortOrder === 'asc'" class="w-4 h-4 mr-1" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                    </svg>
                    <svg *ngIf="sortOrder === 'desc'" class="w-4 h-4 mr-1" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                    {{ sortOrder === 'asc' ? 'تصاعدي' : 'تنازلي' }}
                </button>

                <!-- View Mode Toggle -->
                <div class="flex items-center gap-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                    <button (click)="toggleViewMode('table')"
                        [class]="viewMode === 'table' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'"
                        class="p-2 rounded-md transition-all duration-200 focus-visible:focus" title="عرض الجدول">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                            </path>
                        </svg>
                    </button>
                    <button (click)="toggleViewMode('grid')"
                        [class]="viewMode === 'grid' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'"
                        class="p-2 rounded-md transition-all duration-200 focus-visible:focus" title="عرض الشبكة">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                            </path>
                        </svg>
                    </button>
                    <button (click)="toggleViewMode('cards')"
                        [class]="viewMode === 'cards' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'"
                        class="p-2 rounded-md transition-all duration-200 focus-visible:focus" title="عرض البطاقات">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                            </path>
                        </svg>
                    </button>
                </div>

                <!-- Results Count -->
                <span class="text-sm text-gray-600 dark:text-gray-400">
                    {{ filteredAds.length }} من {{ ads.length }} إعلان
                </span>
            </div>


        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-12">
        <div class="loading-spinner"></div>
    </div>

    <!-- Table View -->
    <div *ngIf="!loading && viewMode === 'table' && paginatedAds.length > 0"
        class="advanced-table dark:bg-gray-700 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-500 dark:divide-gray-700">
                <thead class="table-header">
                    <tr>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            الإعلان
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            الفئة
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            السعر
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            الحالة
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            نوع الإعلان
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            تاريخ الإنشاء
                        </th>
                        <th
                            class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            الإجراءات
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    <tr *ngFor="let ad of paginatedAds" class="table-row">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-16 w-16 relative">
                                    <img [src]="getImageUrl(ad)" [alt]="ad.title"
                                        class="ad-image h-16 w-16 object-cover" loading="lazy" decoding="async"
                                        onerror="this.src='assets/placeholder-image.jpg'">
                                    <div *ngIf="hasMultipleImages(ad)" class="image-overlay">
                                        <span class="text-white text-xs font-medium">+{{ getImageCount(ad) - 1 }}</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 dark:text-white line-clamp-2">{{
                                        ad.title }}</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400 line-clamp-1">{{ ad.description
                                        }}</div>
                                    <div class="text-sm text-gray-400 dark:text-gray-500">{{ ad.location }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span
                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300">
                                {{ ad.categoryTitle }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            {{ formatPrice(ad.price) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            <!-- Status Toggle -->
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" [checked]="ad.isActive" (change)="toggleAdStatus(ad)" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                <span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">
                                    {{ ad.isActive ? 'نشط' : 'غير نشط' }}
                                </span>
                            </label>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span [ngClass]="getAdStatusClass(ad)"
                                class="ad-status-badge">
                                {{ getAdStatusText(ad) }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                            {{ formatDate(ad.createdAt) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex items-center justify-end gap-2">
                                <!-- Payment Button for Specific Ads -->
                                <button *ngIf="canPayForAd(ad)" (click)="openPaymentModal(ad)"
                                    class="action-btn text-purple-600 dark:text-purple-400 hover:text-purple-900 dark:hover:text-purple-300"
                                    title="دفع رسوم الإعلان المميز">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                                        </path>
                                    </svg>
                                </button>
                                <button (click)="editAd(ad)"
                                    class="action-btn text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300"
                                    title="تعديل الإعلان">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                        </path>
                                    </svg>
                                </button>
                                <button (click)="viewAd(ad)"
                                    class="action-btn text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300"
                                    title="عرض الإعلان">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="!loading && viewMode === 'grid' && paginatedAds.length > 0" class="grid-view">
        <div *ngFor="let ad of paginatedAds" class="grid-card">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <!-- Status Toggle for Grid View -->
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" [checked]="ad.isActive" (change)="toggleAdStatus(ad)" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        <span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">
                            {{ ad.isActive ? 'Active' : 'Inactive' }}
                        </span>
                    </label>
                    <!-- Ad Type Status -->
                    <span [ngClass]="getAdStatusClass(ad)"
                        class="ad-status-badge">
                        {{ getAdStatusText(ad) }}
                    </span>
                </div>
                <div class="flex items-center gap-1">
                    <!-- Payment Button for Specific Ads -->
                    <button *ngIf="canPayForAd(ad)" (click)="openPaymentModal(ad)" 
                        class="action-btn text-purple-600 dark:text-purple-400" title="دفع رسوم الإعلان المميز">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                            </path>
                        </svg>
                    </button>
                    <button (click)="editAd(ad)" class="action-btn text-green-600 dark:text-green-400" title="تعديل">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                            </path>
                        </svg>
                    </button>
                    <button (click)="viewAd(ad)" class="action-btn text-blue-600 dark:text-blue-400" title="عرض">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="relative mb-4">
                <img [src]="getImageUrl(ad)" [alt]="ad.title" class="ad-image w-full h-48 object-cover" loading="lazy" decoding="async"
                    onerror="this.src='assets/placeholder-image.jpg'">
                <div *ngIf="hasMultipleImages(ad)" class="image-overlay">
                    <span class="text-white text-sm font-medium">+{{ getImageCount(ad) - 1 }} more</span>
                </div>
            </div>

            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2">{{ ad.title }}</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-3 line-clamp-2">{{ ad.description }}</p>

            <div class="flex items-center justify-between mb-3">
                <span class="text-lg font-bold text-blue-600 dark:text-blue-400">{{ formatPrice(ad.price) }}</span>
                <span class="text-sm text-gray-500 dark:text-gray-400">{{ ad.location }}</span>
            </div>

            <div class="flex items-center justify-between">
                <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300">
                    {{ ad.categoryTitle }}
                </span>
                <span class="text-sm text-gray-500 dark:text-gray-400">{{ formatDate(ad.createdAt) }}</span>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && paginatedAds.length === 0" class="empty-state">
        <svg class="empty-state-icon text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor"
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
            </path>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">لم يتم العثور على إعلانات</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-6">
            {{ filteredAds.length === 0 && ads.length > 0 ? 'جرب تعديل البحث أو المرشحات.' : 'ابدأ بإنشاء إعلانك الأول.' }}
        </p>
        <button routerLink="/ads/create"
            class="btn-primary inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg focus-visible:focus">
            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
                </path>
            </svg>
            إنشاء إعلان جديد
        </button>
    </div>

    <!-- Pagination -->
    <div *ngIf="!loading && totalPages > 1" class="mt-6 flex items-center justify-between">
        <div class="flex-1 flex justify-between sm:hidden">
            <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
                class="pagination-btn relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed focus-visible:focus">
                السابق
            </button>
            <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages"
                class="pagination-btn ml-3 relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed focus-visible:focus">
                التالي
            </button>
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
                <p class="text-sm text-gray-700 dark:text-gray-300">
                    عرض
                    <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span>
                    إلى
                    <span class="font-medium">{{ Math.min(currentPage * itemsPerPage, filteredAds.length) }}</span>
                    من
                    <span class="font-medium">{{ filteredAds.length }}</span>
                    نتيجة
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="التنقل بين الصفحات">

                    <!-- Previous Button -->
                    <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
                        class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700">
                        <span class="sr-only">السابق</span>
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>

                    <!-- Page Numbers -->
                    <button *ngFor="let page of pageNumbers" (click)="onPageChange(page)" [ngClass]="{
              'z-10 bg-blue-50 border-blue-500 text-blue-600 dark:bg-blue-900 dark:text-white': page === currentPage,
              'bg-white text-gray-500 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700': page !== currentPage
            }" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium focus:z-20 dark:border-gray-700">
                        {{ page }}
                    </button>

                    <!-- Next Button -->
                    <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages"
                        class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700">
                        <span class="sr-only">التالي</span>
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>

                </nav>
            </div>

        </div>
    </div>

    <!-- Edit Ad Modal -->
    <div *ngIf="showEditModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
         
            <!-- Modal panel -->
            <div class="edit-modal inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <!-- Modal Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modal-title">
                            تعديل الإعلان
                        </h3>
                        <button (click)="closeEditModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Form -->
                    <form [formGroup]="editForm" (ngSubmit)="onSubmitEdit()" class="space-y-6">
                        <!-- Title -->
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                عنوان الإعلان *
                            </label>
                            <input 
                                type="text" 
                                id="title" 
                                formControlName="title"
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                                placeholder="أدخل عنوان الإعلان"
                            >
                            <div *ngIf="editForm.get('title')?.invalid && editForm.get('title')?.touched" class="mt-1 text-sm text-red-600">
                                <span *ngIf="editForm.get('title')?.errors?.['required']">العنوان مطلوب</span>
                                <span *ngIf="editForm.get('title')?.errors?.['minlength']">العنوان يجب أن يكون 5 أحرف على الأقل</span>
                                <span *ngIf="editForm.get('title')?.errors?.['maxlength']">العنوان يجب أن لا يتجاوز 200 حرف</span>
                            </div>
                        </div>

                        <!-- Description -->
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                وصف الإعلان *
                            </label>
                            <textarea 
                                id="description" 
                                formControlName="description"
                                rows="4"
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                                placeholder="أدخل وصف مفصل للإعلان"
                            ></textarea>
                            <div *ngIf="editForm.get('description')?.invalid && editForm.get('description')?.touched" class="mt-1 text-sm text-red-600">
                                <span *ngIf="editForm.get('description')?.errors?.['required']">الوصف مطلوب</span>
                                <span *ngIf="editForm.get('description')?.errors?.['minlength']">الوصف يجب أن يكون 10 أحرف على الأقل</span>
                                <span *ngIf="editForm.get('description')?.errors?.['maxlength']">الوصف يجب أن لا يتجاوز 2000 حرف</span>
                            </div>
                        </div>

                        <!-- Price and Location Row -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Price -->
                            <div>
                                <label for="price" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    السعر *
                                </label>
                                <input 
                                    type="number" 
                                    id="price" 
                                    formControlName="price"
                                    min="0"
                                    step="0.01"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="0.00"
                                >
                                <div *ngIf="editForm.get('price')?.invalid && editForm.get('price')?.touched" class="mt-1 text-sm text-red-600">
                                    <span *ngIf="editForm.get('price')?.errors?.['required']">السعر مطلوب</span>
                                    <span *ngIf="editForm.get('price')?.errors?.['min']">السعر يجب أن يكون أكبر من أو يساوي 0</span>
                                </div>
                            </div>

                            <!-- Location -->
                            <div>
                                <label for="location" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    الموقع *
                                </label>
                                <input 
                                    type="text" 
                                    id="location" 
                                    formControlName="location"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="أدخل الموقع"
                                >
                                <div *ngIf="editForm.get('location')?.invalid && editForm.get('location')?.touched" class="mt-1 text-sm text-red-600">
                                    <span *ngIf="editForm.get('location')?.errors?.['required']">الموقع مطلوب</span>
                                    <span *ngIf="editForm.get('location')?.errors?.['maxlength']">الموقع يجب أن لا يتجاوز 100 حرف</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phone -->
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                رقم الهاتف
                            </label>
                            <input 
                                type="tel" 
                                id="phone" 
                                formControlName="phone"
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                                placeholder="أدخل رقم الهاتف"
                            >
                        </div>

                        <!-- Active Status -->
                        <div>
                            <label class="flex items-center">
                                <input 
                                    type="checkbox" 
                                    formControlName="isActive"
                                    class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                >
                                <span class="mr-2 text-sm text-gray-700 dark:text-gray-300">تفعيل الإعلان</span>
                            </label>
                        </div>

                        <!-- Images Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                الصور (اختياري)
                            </label>
                            
                            <!-- Image Upload Info -->
                            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                                <div class="flex">
                                    <svg class="w-5 h-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    <div class="mr-3">
                                        <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">ملاحظات مهمة:</h3>
                                        <div class="mt-2 text-sm text-blue-700 dark:text-blue-300">
                                            <ul class="list-disc list-inside space-y-1">
                                                <li>سيتم حذف جميع الصور السابقة</li>
                                                <li><strong>يجب رفع على الأقل 3 صور للتمكن من التعديل</strong></li>
                                                <li>يمكن رفع 3-10 صور</li>
                                                <li>حجم كل صورة لا يتجاوز 5 ميجابايت</li>
                                                <li>المساحة الإجمالية لا تتجاوز 30 ميجابايت</li>
                                                <li>الأنواع المسموحة: JPG, PNG, GIF</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Images Status Message -->
                            <div *ngIf="selectedFiles.length > 0" class="mb-4 p-3 rounded-lg" 
                                 [ngClass]="canSubmitEdit() ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800' : 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800'">
                                <div class="flex items-center">
                                    <svg *ngIf="canSubmitEdit()" class="w-5 h-5 text-green-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <svg *ngIf="!canSubmitEdit()" class="w-5 h-5 text-yellow-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="mr-2 text-sm" 
                                          [ngClass]="canSubmitEdit() ? 'text-green-700 dark:text-green-300' : 'text-yellow-700 dark:text-yellow-300'">
                                        {{ getImagesStatusMessage() }}
                                    </span>
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div 
                                class="file-upload-area border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors"
                                (dragover)="onDragOver($event)"
                                (dragleave)="onDragLeave($event)"
                                (drop)="onDrop($event)"
                                [class.drag-over]="isDragOver"
                            >
                                <input 
                                    type="file" 
                                    #fileInput
                                    multiple
                                    accept="image/*"
                                    (change)="onFileSelected($event)"
                                    class="hidden"
                                >
                                <div class="space-y-4">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="text-gray-600 dark:text-gray-400">
                                        <button 
                                            type="button"
                                            (click)="fileInput.click()"
                                            class="font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300"
                                        >
                                            اختر الصور
                                        </button>
                                        <span class="mr-1">أو اسحب وأفلت</span>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        PNG, JPG, GIF حتى 5MB لكل صورة
                                    </p>
                                </div>
                            </div>

                            <!-- Selected Files Preview -->
                            <div *ngIf="selectedFiles.length > 0" class="mt-4">
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    الصور المختارة ({{ selectedFiles.length }}/10)
                                </h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                    <div *ngFor="let file of selectedFiles; let i = index; trackBy: trackByFile" class="relative group">
                                        <img 
                                            [src]="getFilePreview(file)" 
                                            [alt]="file.name"
                                            class="file-preview w-full h-24 object-cover rounded-lg border border-gray-200 dark:border-gray-600"
                                        >
                                        <button 
                                            type="button"
                                            (click)="removeFile(i)"
                                            class="remove-file-btn absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors"
                                        >
                                            ×
                                        </button>
                                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg">
                                            {{ (file.size / 1024 / 1024).toFixed(2) }} MB
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- File Validation Messages -->
                                <div *ngIf="fileValidationErrors.length > 0" class="mt-2">
                                    <div *ngFor="let error of fileValidationErrors" class="text-sm text-red-600">
                                        {{ error }}
                                    </div>
                                </div>

                                <!-- File Size Summary -->
                                <div *ngIf="selectedFiles.length > 0" class="mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">إجمالي الملفات:</span>
                                        <span class="font-medium">{{ selectedFiles.length }}/10</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm mt-1">
                                        <span class="text-gray-600 dark:text-gray-400">المساحة المستخدمة:</span>
                                        <span class="font-medium">{{ getTotalFileSize() }} / 30 MB</span>
                                    </div>
                                    <div class="mt-2">
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                            <div 
                                                class="progress-bar bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                [style.width.%]="getFileSizePercentage()"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex justify-end space-x-3 space-x-reverse pt-6 border-t border-gray-200 dark:border-gray-700">
                            <button 
                                type="button"
                                (click)="closeEditModal()"
                                class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                            >
                                إلغاء
                            </button>
                            <button 
                                type="submit"
                                [disabled]="editForm.invalid || isSubmitting || !canSubmitEdit()"
                                class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
                                [title]="!canSubmitEdit() ? 'يجب رفع على الأقل 3 صور للتمكن من التعديل' : ''"
                            >
                                <span *ngIf="isSubmitting" class="flex items-center">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    جاري التحديث...
                                </span>
                                <span *ngIf="!isSubmitting">تحديث الإعلان</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div *ngIf="showConfirmModal" class="fixed inset-0 z-60 overflow-y-auto" aria-labelledby="confirm-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->

            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 dark:bg-yellow-900/20 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="confirm-modal-title">
                                تأكيد الإغلاق
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    هل أنت متأكد من إغلاق النافذة؟ سيتم فقدان جميع التغييرات غير المحفوظة.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button 
                        type="button"
                        (click)="confirmClose()"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
                    >
                        إغلاق
                    </button>
                    <button 
                        type="button"
                        (click)="cancelClose()"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                    >
                        إلغاء
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div *ngIf="showPaymentModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="payment-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class=" inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

            <!-- Modal panel -->
            <div class="payment-modal inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <!-- Modal Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="payment-modal-title">
                            دفع رسوم الإعلان المميز
                        </h3>
                        <button (click)="closePaymentModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Payment Form -->
                    <form [formGroup]="paymentForm" (ngSubmit)="onSubmitPayment()" class="space-y-6">
                        <!-- Ad Info -->
                        <div *ngIf="payingAd" class="ad-info-card">
                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">معلومات الإعلان</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">{{ payingAd.title }}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-500">سعر السلعة: {{ formatPrice(payingAd.price) }}</p>
                        </div>

                        <!-- Active Months Selection -->
                        <div>
                            <label for="activeMonths" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                عدد الأشهر للتفعيل *
                            </label>
                            <select 
                                id="activeMonths" 
                                formControlName="activeMonths"
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"
                            >
                                <option value="1">شهر واحد - {{ formatPremiumPrice(getPremiumAdTotalPrice(1)) }}</option>
                                <option value="3">3 أشهر - {{ formatPremiumPrice(getPremiumAdTotalPrice(3)) }}</option>
                                <option value="6">6 أشهر - {{ formatPremiumPrice(getPremiumAdTotalPrice(6)) }}</option>
                                <option value="12">12 شهر - {{ formatPremiumPrice(getPremiumAdTotalPrice(12)) }}</option>
                            </select>
                            <div *ngIf="paymentForm.get('activeMonths')?.invalid && paymentForm.get('activeMonths')?.touched" class="mt-1 text-sm text-red-600">
                                <span *ngIf="paymentForm.get('activeMonths')?.errors?.['required']">عدد الأشهر مطلوب</span>
                                <span *ngIf="paymentForm.get('activeMonths')?.errors?.['min']">يجب أن يكون شهر واحد على الأقل</span>
                                <span *ngIf="paymentForm.get('activeMonths')?.errors?.['max']">لا يمكن أن يتجاوز 12 شهر</span>
                            </div>
                        </div>

                        <!-- Premium Ad Pricing Summary -->
                        <div class="premium-pricing-card bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border border-purple-200 dark:border-purple-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-sm font-medium text-purple-800 dark:text-purple-200">رسوم الإعلان المميز</h4>
                                    <p class="text-xs text-purple-600 dark:text-purple-400">5000 ليرة سورية لكل شهر</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-purple-800 dark:text-purple-200">
                                        {{ formatPremiumPrice(getCurrentPremiumPrice()) }}
                                    </div>
                                    <div class="text-xs text-purple-600 dark:text-purple-400">
                                        {{ paymentForm.get('activeMonths')?.value || 1 }} شهر
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Info -->
                        <div class="payment-info-card">
                            <div class="flex">
                                <svg class="w-5 h-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <div class="mr-3">
                                    <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">معلومات الدفع</h3>
                                    <div class="mt-2 text-sm text-blue-700 dark:text-blue-300">
                                        <p>سيتم توجيهك إلى صفحة الدفع الآمنة لإتمام عملية الدفع.</p>
                                        <p class="mt-1">بعد الدفع الناجح، سيتم تفعيل الإعلان المميز فوراً.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex justify-end space-x-3 space-x-reverse pt-6 border-t border-gray-200 dark:border-gray-700">
                            <button 
                                type="button"
                                (click)="closePaymentModal()"
                                class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                            >
                                إلغاء
                            </button>
                            <button 
                                type="submit"
                                [disabled]="paymentForm.invalid || isProcessingPayment"
                                class="payment-btn px-4 py-2 text-sm font-medium text-white border border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <span *ngIf="isProcessingPayment" class="flex items-center">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    جاري المعالجة...
                                </span>
                                <span *ngIf="!isProcessingPayment">المتابعة للدفع</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
