<!-- Loading State -->
<div *ngIf="loading" class="min-h-screen flex items-center justify-center">
  <div class="text-center">
    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-green-600 mx-auto mb-4"></div>
    <p class="text-gray-600 text-lg">جاري تحميل المزاد...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="min-h-screen flex items-center justify-center">
  <div class="text-center bg-green-50 p-8 rounded-xl max-w-md">
    <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z">
      </path>
    </svg>
    <h3 class="text-xl font-bold text-green-800 mb-2">خطأ في التحميل</h3>
    <p class="text-green-600 mb-4">{{ error }}</p>
    <button (click)="loadPost()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
      إعادة المحاولة
    </button>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="post && !loading" dir="rtl" class="min-h-screen bg-gray-50 dark:bg-gray-900 ads-details-container">
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <!-- Main Content -->
      <div class="flex-1 space-y-6">



        <!-- Image Gallery -->
        <section class="bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-lg">
          <div class="relative">
            <!-- Main Image -->
            <div class="relative aspect-video bg-gray-100 dark:bg-gray-700">
              <img [src]="post.imageUrl[currentImageIndex] || 'assets/placeholder.jpg'"
                [alt]="post.title + ' - صورة ' + (currentImageIndex + 1)"
                class="w-full h-full object-cover rounded-lg transition-all duration-300" loading="lazy"
                decoding="async">

              <!-- Image Navigation -->
              <div *ngIf="post?.imageUrl && post.imageUrl.length > 1"
                class="absolute inset-0 flex items-center justify-between p-4">
                <button (click)="previousImage()"
                  class="bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </button>
                <button (click)="nextImage()"
                  class="bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>

              <!-- Image Counter -->
              <div class="absolute top-4 right-4 bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-sm">
                {{ currentImageIndex + 1 }} / {{ post.imageUrl.length || 1 }}
              </div>

              <!-- Share Button -->
              <button (click)="shareAd()"
                class="absolute top-4 left-4 bg-white bg-opacity-90 text-gray-800 p-2 rounded-full hover:bg-opacity-100 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z">
                  </path>
                </svg>
              </button>

              <!-- Wishlist Button -->
              <button (click)="addToWishlistHandler(post.id)"
                class="absolute top-4 left-16 bg-white bg-opacity-90 text-gray-800 p-2 rounded-full hover:bg-opacity-100 transition group">
                <svg class="w-5 h-5 group-hover:scale-110 transition-transform duration-200" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </button>
            </div>

          </div>
        </section>

        <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white mb-4">
            {{ post.title || adsTitle || 'جاري التحميل...' }}
          </h1>

          <div *ngIf="post.price" class="text-3xl font-bold price-display mb-6 text-green-600 dark:text-green-400">
            {{ post.price|currency }}
          </div>

          <div class="space-y-4">
            <!-- Enhanced Location Section -->
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
              <!-- Location with Map Pin Icon -->
              <div class="flex items-center bg-gray-100 dark:bg-gray-700 px-4 py-3 rounded-lg w-full sm:w-auto">
                <svg class="w-5 h-5 text-primary-600 dark:text-primary-400 flex-shrink-0" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span class="ml-2 font-medium text-gray-800 dark:text-gray-200">
                  {{ post.location || 'الموقع غير محدد' }}
                </span>
              </div>

              <!-- Optional: View on Map Button -->
              <button *ngIf="post.location"
                class="flex items-center justify-center gap-2 px-4 py-3 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-200 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors w-full sm:w-auto">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                عرض على الخريطة
              </button>
            </div>

          </div>
        </section>

        <!-- Post Information -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h2
            class="text-xl font-bold text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-4 mb-6">
            معلومات المزاد</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700">
              <span class="text-gray-600 dark:text-gray-400">القسم</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ post.categoryTitle || category || 'غير محدد'
                }}</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700">
              <span class="text-gray-600 dark:text-gray-400">الموقع</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ post.location || 'غير محدد' }}</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700">
              <span class="text-gray-600 dark:text-gray-400">تاريخ النشر</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ post.createdAt ? formatDate(post.createdAt) :
                'غير محدد' }}</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700">
              <span class="text-gray-600 dark:text-gray-400">رقم المزاد</span>
              <span class="font-semibold text-gray-900 dark:text-white">#{{ post.id || adsId }}</span>
            </div>

            <!-- Dynamic Fields -->
            <div *ngFor="let field of post?.adFieldDtos"
              class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700">
              <span class="text-gray-600 dark:text-gray-400">{{ field.title }}</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{ field.value }}</span>
            </div>
          </div>
        </section>

        <!-- Description -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h2
            class="text-xl font-bold text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-4 mb-6">
            الوصف</h2>
          <p class="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-line">{{ post.description || 'لا
            يوجد وصف متاح' }}</p>
        </section>

        <!-- Report Section -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 dark:text-gray-400">
              رقم المزاد: <strong class="text-gray-900 dark:text-white">#{{ post!.id || adsId }}</strong>
            </span>
            <button routerLink="/dashboard/support" [queryParams]="{ad:post.title}"
              class="text-red-600 hover:text-red-700 flex items-center gap-2 text-sm font-medium transition">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"></path>
              </svg>
              بلغ عن إساءة
            </button>
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3 space-y-6">

        <!-- Contact Post Owner Section -->
        <div
          class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900 dark:to-red-800 rounded-xl shadow-lg p-6 border border-red-200 dark:border-red-700 mb-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="p-2 rounded-full bg-red-100 dark:bg-red-800">
              <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
            <h3 class="text-xl font-bold text-red-800 dark:text-red-200">تواصل مع صاحب المزاد</h3>
          </div>
          <p class="text-sm text-red-700 dark:text-red-300 mb-5">يمكنك التواصل مباشرة مع صاحب هذا المزاد عبر الطرق
            التالية</p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <div
              class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-red-200 dark:border-red-600">
              <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span class="text-sm text-gray-700 dark:text-gray-300">صاحب المزاد</span>
              <span class="text-sm font-medium text-red-600 dark:text-red-400">{{post.userName || 'غير متوفر'}}</span>
            </div>

            <div
              class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-red-200 dark:border-red-600">
              <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M17.707 12.293a.999.999 0 0 0-1.414 0L13 15.586V8a1 1 0 1 0-2 0v7.586l-3.293-3.293a.999.999 0 1 0-1.414 1.414l5 5a.999.999 0 0 0 1.414 0l5-5a.999.999 0 0 0 0-1.414z" />
              </svg>
              <span class="text-sm text-gray-700 dark:text-gray-300">رقم الهاتف</span>
              <span class="text-sm font-medium text-red-600 dark:text-red-400">{{post.phonNumber || 'غير
                متوفر'}}</span>
            </div>
          </div>

          <div class="flex flex-col gap-3">
            <a href="https://wa.me/post.phonNumber" target="_blank"
              class="flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white font-medium px-4 py-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 shadow-md hover:shadow-lg">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd"
                  d="M12 4a8 8 0 0 0-6.895 12.06l.569.718-.697 2.359 2.32-.648.379.243A8 8 0 1 0 12 4ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10a9.96 9.96 0 0 1-5.016-1.347l-4.948 1.382 1.426-4.829-.006-.007-.033-.055A9.958 9.958 0 0 1 2 12Z"
                  clip-rule="evenodd" />
                <path
                  d="M16.735 13.492c-.038-.018-1.497-.736-1.756-.83a1.008 1.008 0 0 0-.34-.075c-.196 0-.362.098-.49.291-.146.217-.587.732-.723.886-.018.02-.042.045-.057.045-.013 0-.239-.093-.307-.123-1.564-.68-2.751-2.313-2.914-2.589-.023-.04-.024-.057-.024-.057.005-.021.058-.074.085-.101.08-.079.166-.182.249-.283l.117-.14c.121-.14.175-.25.237-.375l.033-.066a.68.68 0 0 0-.02-.64c-.034-.069-.65-1.555-.715-1.711-.158-.377-.366-.552-.655-.552-.027 0 0 0-.112.005-.137.005-.883.104-1.213.311-.35.22-.94.924-.94 2.16 0 1.112.705 2.162 1.008 2.561l.041.06c1.161 1.695 2.608 2.951 4.074 3.537 1.412.564 2.081.63 2.461.63.16 0 .288-.013.4-.024l.072-.007c.488-.043 1.56-.599 1.804-1.276.192-.534.243-1.117.115-1.329-.088-.144-.239-.216-.43-.308Z" />
              </svg>
              واتساب
            </a>

            <button (click)="copyPhoneNumber(post.phonNumber)"
              class="flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 shadow-md hover:shadow-lg"
              [disabled]="!post.phonNumber" [class.opacity-50]="!post.phonNumber">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M20 4H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm0 2v.511l-8 6.223-8-6.222V6h16zM4 18V9.044l7.386 5.745a.994.994 0 0 0 1.228 0L20 9.044 20.002 18H4z" />
              </svg>
              نسخ رقم الهاتف
            </button>
          </div>
        </div>

        <!-- Contact Section -->
        <div
          class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-xl shadow-lg p-6 border border-gray-100 dark:border-gray-700">
          <div class="flex items-center gap-3 mb-4">
            <div class="p-2 rounded-full">
              <svg class="w-6 h-6" style="color:#dc2626;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" />
                <path d="M11 11h2v6h-2zm0-4h2v2h-2z" />
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 dark:text-white">هل تحتاج إلى مساعدة؟</h3>
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-5">فريق الدعم لدينا متاح 24/7 للإجابة على استفساراتك
          </p>
          <div class="flex flex-col gap-3">
            <a href="https://wa.me/00963951672261" target="_blank"
              class="flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white font-medium px-4 py-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 shadow-md hover:shadow-lg">
              واتساب
              <svg class="w-6 h-6  dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24"
                height="24" fill="none" viewBox="0 0 24 24">
                <path fill="currentColor" fill-rule="evenodd"
                  d="M12 4a8 8 0 0 0-6.895 12.06l.569.718-.697 2.359 2.32-.648.379.243A8 8 0 1 0 12 4ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10a9.96 9.96 0 0 1-5.016-1.347l-4.948 1.382 1.426-4.829-.006-.007-.033-.055A9.958 9.958 0 0 1 2 12Z"
                  clip-rule="evenodd" />
                <path fill="currentColor"
                  d="M16.735 13.492c-.038-.018-1.497-.736-1.756-.83a1.008 1.008 0 0 0-.34-.075c-.196 0-.362.098-.49.291-.146.217-.587.732-.723.886-.018.02-.042.045-.057.045-.013 0-.239-.093-.307-.123-1.564-.68-2.751-2.313-2.914-2.589-.023-.04-.024-.057-.024-.057.005-.021.058-.074.085-.101.08-.079.166-.182.249-.283l.117-.14c.121-.14.175-.25.237-.375l.033-.066a.68.68 0 0 0-.02-.64c-.034-.069-.65-1.555-.715-1.711-.158-.377-.366-.552-.655-.552-.027 0 0 0-.112.005-.137.005-.883.104-1.213.311-.35.22-.94.924-.94 2.16 0 1.112.705 2.162 1.008 2.561l.041.06c1.161 1.695 2.608 2.951 4.074 3.537 1.412.564 2.081.63 2.461.63.16 0 .288-.013.4-.024l.072-.007c.488-.043 1.56-.599 1.804-1.276.192-.534.243-1.117.115-1.329-.088-.144-.239-.216-.43-.308Z" />
              </svg>


            </a>
            <button (click)="copyPhoneNumber('00963951672261')"
              class="flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 shadow-md hover:shadow-lg"
              [disabled]="!post.phonNumber">
              تواصل معنا
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M20 4H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm0 2v.511l-8 6.223-8-6.222V6h16zM4 18V9.044l7.386 5.745a.994.994 0 0 0 1.228 0L20 9.044 20.002 18H4z" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Seller Information -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">معلومات صاحب المزاد</h3>
          <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center">
              <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            <div>
              <h4 class="font-bold text-gray-900 dark:text-white">{{ post.userName || 'غير محدد' }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                {{ post.createdAt ? 'تم النشر من ' + formatDate(post.createdAt) : 'جاري التحميل...' }}
              </p>
            </div>
          </div>

        </section>

        <!-- Location Map -->
        <section class="bg-white dark:bg-gray-800 p-10 rounded-2xl shadow-lg">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">الموقع</h3>
          <div class="bg-gray-200 dark:bg-gray-700 rounded-xl h-48 flex items-center justify-center">
            <div class="text-center">
              <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <p class="text-gray-600 dark:text-gray-400 text-sm">{{ post.location }}</p>
            </div>
          </div>

        </section>


      </aside>
    </div>
  </div>
</div>